/*!
 * cross-end-canvas - 提供跨端的canvas画笔，保持一致的绘图方法和效果，包括普通的web端、uniapp框架、微信小程序等小程序等。
 *
 * git+https://github.com/hai2007/cross-end-canvas.git
 *
 * author 你好2007 < https://hai2007.gitee.io/sweethome >
 *
 * version 0.1.1
 *
 * Copyright (c) 2021 hai2007 走一步，再走一步。
 * Released under the MIT license
 *
 * Date:Tue Aug 24 2021 11:02:07 GMT+0800 (中国标准时间)
 */
(function(){"use strict";function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function(obj){return typeof obj}}else{_typeof=function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}var rotate=function rotate(cx,cy,deg,x,y){var cos=Math.cos(deg),sin=Math.sin(deg);return[+((x-cx)*cos-(y-cy)*sin+cx).toFixed(7),+((x-cx)*sin+(y-cy)*cos+cy).toFixed(7)]};function arc(beginA,rotateA,cx,cy,r1,r2,doback){if(rotateA<0){beginA+=rotateA;rotateA*=-1}var temp=[],p;p=rotate(0,0,beginA,r1,0);temp[0]=p[0];temp[1]=p[1];p=rotate(0,0,rotateA,p[0],p[1]);temp[2]=p[0];temp[3]=p[1];p=rotate(0,0,beginA,r2,0);temp[4]=p[0];temp[5]=p[1];p=rotate(0,0,rotateA,p[0],p[1]);temp[6]=p[0];temp[7]=p[1];doback(beginA,beginA+rotateA,temp[0]+cx,temp[1]+cy,temp[4]+cx,temp[5]+cy,temp[2]+cx,temp[3]+cy,temp[6]+cx,temp[7]+cy,(r2-r1)*.5)}var initPainterConfig={fillStyle:"black",strokeStyle:"black",lineWidth:1,textAlign:"left",textBaseline:"middle","font-size":16,"font-family":"sans-serif","arc-start-cap":"butt","arc-end-cap":"butt",lineDash:[],shadowBlur:0,shadowColor:"black"};var initText=function initText(painter,config,x,y,deg,platform){painter.beginPath();painter.translate(x,y);painter.rotate(deg);if(platform!="web"){painter.setFontSize(config["font-size"])}else{painter.font=config["font-size"]+"px "+config["font-family"]}return painter};var initArc=function initArc(painter,config,cx,cy,r1,r2,beginDeg,deg){if(r1>r2){var temp=r1;r1=r2;r2=temp}beginDeg=beginDeg%(Math.PI*2);if(deg>=Math.PI*1.999999||deg<=-Math.PI*1.999999){deg=Math.PI*2}else{deg=deg%(Math.PI*2)}arc(beginDeg,deg,cx,cy,r1,r2,(function(beginA,endA,begInnerX,begInnerY,begOuterX,begOuterY,endInnerX,endInnerY,endOuterX,endOuterY,r){if(r<0)r=-r;painter.beginPath();painter.moveTo(begInnerX,begInnerY);painter.arc(cx,cy,r1,beginA,endA,false);if(config["arc-end-cap"]!="round")painter.lineTo(endOuterX,endOuterY);else painter.arc((endInnerX+endOuterX)*.5,(endInnerY+endOuterY)*.5,r,endA-Math.PI,endA,true);painter.arc(cx,cy,r2,endA,beginA,true);if(config["arc-start-cap"]!="round")painter.lineTo(begInnerX,begInnerY);else painter.arc((begInnerX+begOuterX)*.5,(begInnerY+begOuterY)*.5,r,beginA,beginA-Math.PI,true)}));if(config["arc-start-cap"]=="butt")painter.closePath();return painter};var initCircle=function initCircle(painter,cx,cy,r){painter.beginPath();painter.moveTo(cx+r,cy);painter.arc(cx,cy,r,0,Math.PI*2);return painter};var initRect=function initRect(painter,x,y,width,height){painter.beginPath();painter.rect(x,y,width,height);return painter};var linearGradient=function linearGradient(painter,x0,y0,x1,y1){var gradient=painter.createLinearGradient(x0,y0,x1,y1);var enhanceGradient={value:function value(){return gradient},addColorStop:function addColorStop(stop,color){gradient.addColorStop(stop,color);return enhanceGradient}};return enhanceGradient};var radialGradient=function radialGradient(painter,cx,cy,r){var gradient=painter.createRadialGradient(cx,cy,0,cx,cy,r);var enhanceGradient={value:function value(){return gradient},addColorStop:function addColorStop(stop,color){gradient.addColorStop(stop,color);return enhanceGradient}};return enhanceGradient};var unSupportAttr={};function painterFactory(painter,platform){var config={};var useConfig=platform=="uni-app"?function(key,value){if(["font-size","font-family","arc-start-cap","arc-end-cap"].indexOf(key)>-1){config[key]=value}else{try{painter["set"+key[0].toUpperCase()+key.substr(1)](value)}catch(e){if(!unSupportAttr[platform]){unSupportAttr[platform]={}}if(!unSupportAttr[platform][key]){unSupportAttr[platform][key]=true;console.warn("内置画笔的"+key+"属性在"+platform+"平台上不支持！")}}}}:function(key,value){if(key=="lineDash"){painter.setLineDash(value)}else if(["font-size","font-family","arc-start-cap","arc-end-cap"].indexOf(key)>-1){config[key]=value}else if(key in initPainterConfig){painter[key]=value}else{throw new Error("Illegal configuration item of painter : "+key+" !")}};var enhancePainter={config:function config(){if(arguments.length===1){if(_typeof(arguments[0])!=="object")return painter[arguments[0]];for(var key in arguments[0]){useConfig(key,arguments[0][key])}}else if(arguments.length===2){useConfig(arguments[0],arguments[1])}return enhancePainter},fillText:function fillText(text,x,y,deg){painter.save();initText(painter,config,x,y,deg||0,platform).fillText(text,0,0);painter.restore();return enhancePainter},strokeText:function strokeText(text,x,y,deg){painter.save();initText(painter,config,x,y,deg||0,platform).strokeText(text,0,0);painter.restore();return enhancePainter},fullText:function fullText(text,x,y,deg){painter.save();initText(painter,config,x,y,deg||0,platform);painter.fillText(text,0,0);painter.strokeText(text,0,0);painter.restore();return enhancePainter},beginPath:function beginPath(){painter.beginPath();return enhancePainter},closePath:function closePath(){painter.closePath();return enhancePainter},moveTo:function moveTo(x,y){painter.moveTo(x,y);return enhancePainter},lineTo:function lineTo(x,y){painter.lineTo(x,y);return enhancePainter},arc:function arc(x,y,r,beginDeg,deg){painter.arc(x,y,r,beginDeg,beginDeg+deg,deg<0);return enhancePainter},fill:function fill(){painter.fill();return enhancePainter},stroke:function stroke(){painter.stroke();return enhancePainter},full:function full(){painter.fill();painter.stroke();return enhancePainter},save:function save(){painter.save();return enhancePainter},restore:function restore(){painter.restore();return enhancePainter},quadraticCurveTo:function quadraticCurveTo(cpx,cpy,x,y){painter.quadraticCurveTo(cpx,cpy,x,y);return enhancePainter},bezierCurveTo:function bezierCurveTo(cp1x,cp1y,cp2x,cp2y,x,y){painter.bezierCurveTo(cp1x,cp1y,cp2x,cp2y,x,y);return enhancePainter},clearRect:function clearRect(x,y,w,h){painter.clearRect(x,y,w,h);return enhancePainter},fillArc:function fillArc(cx,cy,r1,r2,beginDeg,deg){initArc(painter,config,cx,cy,r1,r2,beginDeg,deg).fill();return enhancePainter},strokeArc:function strokeArc(cx,cy,r1,r2,beginDeg,deg){initArc(painter,config,cx,cy,r1,r2,beginDeg,deg).stroke();return enhancePainter},fullArc:function fullArc(cx,cy,r1,r2,beginDeg,deg){initArc(painter,config,cx,cy,r1,r2,beginDeg,deg);painter.fill();painter.stroke();return enhancePainter},fillCircle:function fillCircle(cx,cy,r){initCircle(painter,cx,cy,r).fill();return enhancePainter},strokeCircle:function strokeCircle(cx,cy,r){initCircle(painter,cx,cy,r).stroke();return enhancePainter},fullCircle:function fullCircle(cx,cy,r){initCircle(painter,cx,cy,r);painter.fill();painter.stroke();return enhancePainter},fillRect:function fillRect(x,y,width,height){initRect(painter,x,y,width,height).fill();return enhancePainter},strokeRect:function strokeRect(x,y,width,height){initRect(painter,x,y,width,height).stroke();return enhancePainter},fullRect:function fullRect(x,y,width,height){initRect(painter,x,y,width,height);painter.fill();painter.stroke();return enhancePainter},createLinearGradient:function createLinearGradient(x0,y0,x1,y1){return linearGradient(painter,x0,y0,x1,y1)},createRadialGradient:function createRadialGradient(cx,cy,r){return radialGradient(painter,cx,cy,r)}};if(platform=="uni-app")enhancePainter.draw=function(){painter.draw();return enhancePainter};return enhancePainter}var CrossEndCanvas=function CrossEndCanvas(config){return new Promise((function(resolve,reject){if(config.platform=="web"){var canvas=document.getElementById(config.id);var width=canvas.clientWidth,height=canvas.clientHeight;canvas.style.width=width+"px";canvas.style.height=height+"px";canvas.setAttribute("width",width*2);canvas.setAttribute("height",height*2);var painter=canvas.getContext("2d");painter.scale(2,2);resolve([painter,config.platform])}else if(config.platform=="uni-app"){resolve([uni.createCanvasContext(config.id,config.target),config.platform])}else if(config.platform=="weixin"){var dpr=wx.getSystemInfoSync().pixelRatio;wx.createSelectorQuery()["in"](config.target).select("#"+config.id).fields({node:true,size:true}).exec((function(res){var canvas=res[0].node;var painter=canvas.getContext("2d");canvas.width=res[0].width*dpr;canvas.height=res[0].height*dpr;painter.scale(dpr,dpr);resolve([painter,config.platform])}))}else{reject("你必须配置一个合法的平台")}})).then((function(data){return painterFactory(data[0],data[1])}))};if((typeof module==="undefined"?"undefined":_typeof(module))==="object"&&_typeof(module.exports)==="object"){module.exports=CrossEndCanvas}else{window.CrossEndCanvas=CrossEndCanvas}})();